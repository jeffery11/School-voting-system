<!-- Create realtime-demo.html in frontend folder -->
<!DOCTYPE html>
<html>
<head>
    <title>Live Voting Demo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status-panel { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .candidate-card { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 6px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .vote-btn { 
            background: #28a745; 
            color: white; 
            border: none; 
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .live-badge { 
            background: #dc3545; 
            color: white; 
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        .results { margin-top: 20px; }
        .vote-log { 
            background: #f8f9fa; 
            padding: 10px; 
            margin-top: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>🎯 Live Voting System Demo</h1>
    
    <div class="status-panel">
        <div>Status: <span id="status">Connecting...</span></div>
        <div>Connected Clients: <span id="clients">0</span></div>
        <div>Total Votes: <span id="totalVotes">0</span></div>
    </div>

    <div class="voting-section">
        <h2>🗳️ Cast Your Vote</h2>
        <div id="candidatesList">
            <!-- Candidates will be loaded here -->
        </div>
    </div>

    <div class="results">
        <h2>📊 Live Results <span class="live-badge">LIVE</span></h2>
        <div id="resultsContainer">
            <!-- Results will be updated in real-time -->
        </div>
    </div>

    <div class="activity">
        <h3>📝 Recent Activity</h3>
        <div id="voteLog" class="vote-log">
            No votes yet...
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let voteLog = [];

        // Connection handling
        socket.on('connect', () => {
            document.getElementById('status').innerHTML = '<span style="color: green;">🟢 Connected</span>';
            console.log('Connected to real-time server');
        });

        socket.on('disconnect', () => {
            document.getElementById('status').innerHTML = '<span style="color: red;">🔴 Disconnected</span>';
        });

        // Initial data load
        socket.on('initial-data', (data) => {
            document.getElementById('clients').textContent = data.connectedClients;
            document.getElementById('totalVotes').textContent = data.totalVotes;
            loadCandidates(data.candidates);
            updateResults(data.candidates, data.totalVotes);
        });

        // Real-time updates
        socket.on('vote-update', (data) => {
            document.getElementById('clients').textContent = data.connectedClients;
            document.getElementById('totalVotes').textContent = data.totalVotes;
            
            // Update results
            updateResults(data.results, data.totalVotes);
            
            // Add to vote log
            addToVoteLog(data.newVote);
        });

        // Vote confirmation
        socket.on('vote-confirmed', (data) => {
            alert('✅ ' + data.message);
        });

        // Load candidates
        function loadCandidates(candidates) {
            const container = document.getElementById('candidatesList');
            let html = '';
            
            candidates.forEach(candidate => {
                html += `
                    <div class="candidate-card">
                        <div>
                            <strong>${candidate.name}</strong><br>
                            <small>${candidate.position}</small>
                        </div>
                        <button class="vote-btn" onclick="castVote(${candidate.id}, '${candidate.name}')">
                            Vote for ${candidate.name.split(' ')[0]}
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update results display
        function updateResults(results, totalVotes) {
            const container = document.getElementById('resultsContainer');
            let html = '';
            
            if (totalVotes === 0) {
                html = '<p>No votes cast yet. Be the first to vote!</p>';
            } else {
                // Convert results object to array and sort by votes
                const resultsArray = Object.values(results).sort((a, b) => b.votes - a.votes);
                
                resultsArray.forEach(result => {
                    const percentage = totalVotes > 0 ? ((result.votes / totalVotes) * 100).toFixed(1) : 0;
                    html += `
                        <div class="candidate-card">
                            <div>
                                <strong>${result.candidate.name}</strong><br>
                                <small>${result.candidate.position}</small>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2em; font-weight: bold;">${result.votes} votes</div>
                                <small>${percentage}%</small>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        // Cast vote function
        function castVote(candidateId, candidateName) {
            const studentId = 'student-' + Math.floor(Math.random() * 1000);
            
            socket.emit('submit-vote', {
                studentId: studentId,
                candidateId: candidateId
            });
        }

        // Add to vote log
        function addToVoteLog(vote) {
            voteLog.unshift(vote);
            if (voteLog.length > 10) voteLog = voteLog.slice(0, 10);
            
            const logContainer = document.getElementById('voteLog');
            let html = '';
            
            voteLog.forEach(vote => {
                const time = new Date(vote.timestamp).toLocaleTimeString();
                html += `<div>🕒 ${time} - ${vote.studentId} voted for ${vote.candidateName}</div>`;
            });
            
            logContainer.innerHTML = html || 'No votes yet...';
        }

        // Request current results
        socket.emit('get-results');
    </script>
</body>
</html>